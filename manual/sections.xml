<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter SYSTEM "docbook-dtd-45/docbookx.dtd">

<chapter id="sections">
  <title>Sections</title>

  <indexterm>
    <primary>SECTION</primary>
  </indexterm>
  <indexterm>
    <primary>MAPPINGS</primary>
  </indexterm>
  <indexterm>
    <primary>SETS</primary>
  </indexterm>
  <indexterm>
    <primary>CORRECTIONS</primary>
  </indexterm>
  <indexterm>
    <primary>CONSTRAINTS</primary>
  </indexterm>
  <para>
    CG-2 has three seperate grammar sections: <link linkend="keyword-sets">SETS</link>,
    <link linkend="keyword-mappings">MAPPINGS</link>,
    and <link linkend="keyword-constraints">CONSTRAINTS</link>.
    VISLCG added to these with the <link linkend="keyword-corrections">CORRECTIONS</link> section.
    Each of these can only contain certain definitions, such as LIST, MAP, or SELECT.
    As I understand it, this was due to the original CG parser being written in a language
    that needed such a format. In any case, I did not see the logic or usability in
    such a strict format. VISL CG-3 has a single section header
    <link linkend="keyword-section">SECTION</link>, which can contain
    any of the set or rule definitions. Sections can also be given a name for easier
    identification and anchor behavior, but that is optional. The older section
    headings are still valid and will work as expected, though.
  </para>
  <para>
    By allowing any set or rule definition anywhere you could write a grammar such as:
    <screen>
      DELIMITERS = "&lt;$.&gt;" ;
      LIST ThisIsASet = "&lt;sometag&gt;" "&lt;othertag&gt;" ;

      SECTION
      LIST ThisIsAlsoASet = atag btag ctag ;
      SET Hubba =  ThisIsASet â€“ (ctag) ;
      SELECT ThisIsASet IF (-1 (dtag)) ;
      LIST AnotherSet =  "&lt;youknowthedrill&gt;" ;

      MAP (@bingo) TARGET AnotherSet ;
    </screen>
  </para>
  <para>
    Notice that the first LIST ThisIsASet is outside a section.
    This is because sets are considered global regardless of where
    they are declared and can as such be declared anywhere, even before the
    DELIMITERS declaration should you so desire1. A side effect of this is
    that set names must be unique across the entire grammar, but as this is
    also the behavior of CG-2 and VISLCG that should not be a surprise nor problem.
  </para>
  <para>
    Rules are applied in the order they are declared. In the above example
    that would execute SELECT first and then the MAP rule.
  </para>

  <section id="sect-before-sections">
    <title>BEFORE-SECTIONS</title>
    <para>
      See <link linkend="keyword-before-sections">BEFORE-SECTIONS</link>.
      Takes the place of what previously were the MAPPINGS and CORRECTIONS blocks,
      but may contain any rule type.
    </para>
  </section>

  <section id="sect-sections">
    <title>SECTION</title>
    <para>
      See <link linkend="keyword-section">SECTION</link>.
      Takes the place of what previously were the CONSTRAINTS blocks,
      but may contain any rule type.
    </para>
  </section>

  <section id="sect-after-sections">
    <title>AFTER-SECTIONS</title>
    <para>
      See <link linkend="keyword-after-sections">AFTER-SECTIONS</link>.
      May contain any rule type, and is run once after all other sections.
      This is new in CG-3.
    </para>
  </section>

</chapter>
